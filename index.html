<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SmartTreasurer</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>

    <!-- Opening Authentication Screen -->
    <div class="opening-screen" id="openingScreen">
        <div class="opening-content">
            <div class="opening-icon"><i class="fas fa-sack-dollar fa-bounce"></i></div>
            <h1><i class="fas fa-university"></i> Welcome to SmartTreasurer</h1>
            <p>Efficiently manage student payments.</p>

            <div class="auth-toggle">
                <button class="toggle-btn active" onclick="showLogin()"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button class="toggle-btn" onclick="showSignup()"><i class="fas fa-user-plus"></i> Sign Up</button>
            </div>

            <!-- Login Form -->
            <div class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="loginUsername"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter your username" class="auth-input" />
                </div>
                <div class="form-group">
                    <label for="loginPassword"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" class="auth-input" />
                </div>
                <p id="loginError" class="error-message" style="display: none;"><i class="fas fa-exclamation-circle"></i> Incorrect credentials. Please try again.</p>
                <button class="start-btn" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button class="delete-btn" onclick="deleteAccount()"><i class="fas fa-trash-alt"></i> Delete Account</button>
            </div>

            <!-- Signup Form -->
            <div class="signup-form" id="signupForm" style="display: none;">
                <div class="form-group">
                    <label for="signupUsername"><i class="fas fa-user-check"></i> Username</label>
                    <input type="text" id="signupUsername" placeholder="Choose a username" class="auth-input" />
                </div>
                <div class="form-group">
                    <label for="signupPassword"><i class="fas fa-key"></i> Password</label>
                    <input type="password" id="signupPassword" placeholder="Choose a password" class="auth-input" />
                </div>
                <div class="form-group">
                    <label for="confirmPassword"><i class="fas fa-check-double"></i> Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm your password" class="auth-input" />
                </div>
                <p id="signupError" class="error-message" style="display: none;"><i class="fas fa-exclamation-triangle"></i> Error message here.</p>
                <button class="start-btn" onclick="signup()"><i class="fas fa-user-plus"></i> Sign Up</button>
            </div>
        </div>
    </div>

    <!-- Theme switch being hidden for now -->
     <!-- NOTE: Remove this in the future including the dependencies in script.js -->
    <div class="theme-switch hidden">
        <span class="theme-label" id="themeLabel"><i class="fas fa-sun"></i> Light Mode</span>
        <label class="switch">
            <input type="checkbox" id="themeToggle" />
            <span class="slider"></span>
        </label>
    </div>

    <!-- Main Container -->
    <div class="container">
        <header class="app-header">
            <h1><i class="fas fa-university"></i> SmartTreasurer Dashboard</h1>
        </header>

        <!-- Summary Section -->
        <div class="summary-box card">
            <h2><i class="fas fa-chart-pie"></i> Overall Summary</h2>
            <div class="summary-grid">
                <p><i class="fas fa-money-bill-wave"></i> Total Amount: <strong>₱<span id="totalAmount">0</span></strong></p>
                <p><i class="fas fa-users"></i> Total Students: <strong id="totalStudents">0</strong></p>
                <p><i class="fas fa-check-circle status-paid"></i> Total Paid: <strong id="totalPaid">0</strong></p>
                <p><i class="fas fa-times-circle status-unpaid"></i> Total Unpaid: <strong id="totalUnpaid">0</strong></p>
                <!-- Add this new line for target progress -->
                <p><i class="fas fa-bullseye"></i> Target Progress: 
                    <strong id="targetProgress">₱0 / ₱0 (0%)</strong>
                    <span id="targetAchieved" style="display:none; margin-left:10px;">
                        <i class="fas fa-check-circle" style="color:var(--success-color)"></i> Target Achieved!
                    </span>
                </p>
            </div>
        </div>

        <div class="current-category" id="currentCategoryDisplay">
            <h2 id="currentCategoryName">No Category Selected</h2>
            <p id="currentCategoryDescription">Please select a category to view student payments</p>
        </div>


        <!-- Charts Section -->
        <div class="charts-section card">
            <h2><i class="fas fa-chart-pie"></i> Payment Distribution</h2>
            <div class="charts-container">
                <div class="chart-card">
                    <canvas id="summaryPieChart" ></canvas>
                </div>
                <div class="chart-card">
                    <canvas id="summaryBarChart"></canvas>
                </div>
            </div>
        </div>

                <!-- Add Student / Bulk Add Modal -->
        <div id="addStudentModal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2 id="modalTitle"><i class="fas fa-user-plus"></i> Add New Student</h2>
                    <span class="close" onclick="hideAddStudentModal()">×</span>
                </div>

                <!-- Tab Switcher -->
                <div class="modal-tabs">
                    <div class="tab active" onclick="switchTab('single')">
                        <i class="fas fa-user"></i> Single Add
                    </div>
                    <div class="tab" onclick="switchTab('bulk')">
                        <i class="fas fa-users"></i> Bulk Add
                    </div>
                </div>

                <!-- Single Add Form -->
                <form id="studentForm" class="modal-form tab-content active">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName"><i class="fas fa-user"></i> First Name</label>
                            <input type="text" id="firstName" required placeholder="e.g., Juan" />
                        </div>
                        <div class="form-group small">
                            <label for="middleInitial"><i class="fas fa-user"></i> M.I.</label>
                            <input type="text" id="middleInitial" placeholder="B" maxlength="1" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="lastName"><i class="fas fa-user"></i> Last Name</label>
                        <input type="text" id="lastName" required placeholder="e.g., Dela Cruz" />
                    </div>

                    <div class="form-group">
                        <label for="section"><i class="fas fa-users-rectangle"></i> Section</label>
                        <input type="text" id="section" required placeholder="e.g., BSCS-3A" />
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount"><i class="fas fa-coins"></i> Amount (₱)</label>
                            <input type="number" id="amount" required placeholder="100" step="0.01" min="0" />
                        </div>
                        <div class="form-group">
                            <label for="isPaid"><i class="fas fa-cash-register"></i> Status</label>
                            <select id="isPaid" class="modern-select">
                                <option value="false">⚠️ Unpaid</option>
                                <option value="true">✅ Paid</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-plus-circle"></i> Add Student
                    </button>
                </form>

                <!-- Bulk Add Form -->
                <form id="bulkAddForm" class="modal-form tab-content">
                    <div class="form-group">
                        <label for="bulkSection"><i class="fas fa-users-rectangle"></i> Section</label>
                        <input type="text" id="bulkSection" required placeholder="e.g., BSIT-2B" />
                    </div>
                    <div class="form-group">
                        <label for="studentNames"><i class="fas fa-list-ul"></i> Student Names (First M. Last per line)</label>
                        <textarea id="studentNames" rows="6" placeholder="Accepted formats:&#10;Dela Cruz, Juan B.&#10;Smith, Mary Jane&#10;Juan B. Dela Cruz&#10;Mary Jane Smith" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-plus-circle"></i> Add Students
                    </button>
                </form>
            </div>
        </div>

        <!-- Edit Form -->
        <div id="editForm" class="edit-form card" style="display: none;">
            <div class="edit-form-header">
                <h2><i class="fas fa-edit"></i> Edit Student</h2>
            </div>
            <form id="studentEditForm" class="full-width-form">
                <input type="hidden" id="editIndex" />
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editFirstName"><i class="fas fa-user"></i> First Name</label>
                        <input type="text" id="editFirstName" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="editMiddleInitial"><i class="fas fa-user"></i> M.I.</label>
                        <input type="text" id="editMiddleInitial" maxlength="1" />
                    </div>
                    
                    <div class="form-group">
                        <label for="editLastName"><i class="fas fa-user"></i> Last Name</label>
                        <input type="text" id="editLastName" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="editSection"><i class="fas fa-users-rectangle"></i> Section</label>
                        <input type="text" id="editSection" required />
                    </div>
                    
                    <div class="form-group">
                        <label for="editAmount"><i class="fas fa-coins"></i> Amount (₱)</label>
                        <input type="number" id="editAmount" required step="0.01" min="0" />
                    </div>
                    
                    <div class="form-group">
                        <label for="editIsPaid"><i class="fas fa-cash-register"></i> Status</label>
                        <select id="editIsPaid" class="modern-select">
                            <option value="false">⚠️ Unpaid</option>
                            <option value="true">✅ Paid</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editPaymentDate"><i class="fas fa-calendar-alt"></i> Date</label>
                        <input type="date" id="editPaymentDate" class="modern-input" />
                        <small class="form-hint">Leave blank for today</small>
                    </div>
                </div>
                
                <div class="edit-form-actions">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="hideEditForm()"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </form>
        </div>

        <!-- Search -->
        <div class="search-container card">
            <div class="search-header">
                <h2><i class="fas fa-search"></i> Search Students</h2>
            </div>
            <div class="search-controls">
                <div class="search-input-container">
                    <input type="text" id="searchInput" placeholder="Search by name or section..." class="search-input">
                    <div class="search-actions">
                        <button class="btn btn-primary" onclick="searchStudents()"><i class="fas fa-search"></i> Search</button>
                        <button class="btn btn-secondary" onclick="clearSearch()"><i class="fas fa-times"></i> Clear</button>
                    </div>
                </div>
                <div class="search-filters">
                    <label><input type="checkbox" id="searchPaid" checked> Paid</label>
                    <label><input type="checkbox" id="searchUnpaid" checked> Unpaid</label>
                    <select id="searchSection" class="modern-select">
                        <option value="">All Sections</option>
                    </select>
                </div>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>

        <!-- Section Lists -->
        <h2 class="section-title"><i class="fas fa-list-ul"></i> Student Payments by Section</h2>
        <div id="sectionLists">
            <p id="noStudentsMessage" style="text-align: center; padding: 20px; color: var(--text-muted);">No student data available. Add students or import from Excel.</p>
        </div>

        <!-- Section Summary Table -->
        <h2 class="section-title"><i class="fas fa-chart-bar"></i> Section Summary</h2>
        <div class="table-responsive card">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th><i class="fas fa-users-rectangle"></i> Section</th>
                        <th><i class="fas fa-user-friends"></i> Students</th>
                        <th><i class="fas fa-coins"></i> Total Amt.</th>
                        <th><i class="fas fa-check-circle"></i> Paid</th>
                        <th><i class="fas fa-exclamation-circle"></i> Unpaid</th>
                        <th><i class="fas fa-calendar-check"></i> Latest Payment</th>
                    </tr>
                </thead>
                <tbody id="sectionSummary">
                    <tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--text-muted);">No section summary available.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>© 2023 SmartTreasurer. All rights reserved.</p>
    </footer>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="sidebar-content">
            <div class="sidebar-header">
                <h3><i class="fas fa-university"></i> Menu</h3>
            </div>
            <ul class="sidebar-menu">
                <!-- Active Category Selector -->
                <li>
                    <div class="form-group">
                        <label for="activeCategorySelect"><i class="fas fa-tag"></i> Active Category:</label>
                        <select id="activeCategorySelect" class="modern-select sidebar-select">
                            <option value="">Select a category</option>
                        </select>
                    </div>
                </li>

                <!-- Primary Action -->
                <li>
                    <button onclick="showAddStudentModal()" class="btn btn-primary sidebar-btn">
                        <i class="fas fa-user-plus"></i> Add Student
                    </button>
                </li>

                <!-- Analytics & Tools -->
                <li>
                    <button onclick="showSectionCharts()" class="btn btn-secondary sidebar-btn">
                        <i class="fas fa-chart-pie"></i> Charts
                    </button>
                </li>
                <li>
                    <label for="excelFile" class="btn btn-secondary sidebar-btn">
                        <i class="fas fa-file-import"></i> Import
                    </label>
                    <input type="file" id="excelFile" accept=".xlsx" onchange="importFromExcel(this)" style="display: none;" />
                </li>
                <li>
                    <button onclick="exportToExcel()" class="btn btn-secondary sidebar-btn">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                </li>

                <!-- Appearance & Settings -->
                <li>
                    <button onclick="toggleThemeFromSidebar()" class="btn btn-secondary sidebar-btn">
                        <i class="fas fa-moon"></i> Toggle Theme
                    </button>
                </li>
                <li>
                    <button onclick="showCategoryManagement()" class="btn btn-secondary sidebar-btn">
                        <i class="fas fa-layer-group"></i> Manage Categories
                    </button>
                </li>

                <!-- Danger Zone -->
                <li>
                    <button onclick="deleteSectionPrompt()" class="btn btn-danger sidebar-btn">
                        <i class="fas fa-trash-alt"></i> Delete Section
                    </button>
                </li>
                <li>
                    <button onclick="logout()" class="btn btn-danger sidebar-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <!-- Section Charts Modal -->
    <div id="sectionChartsModal" class="modal">
        <div class="modal-content card">
            <span class="close" onclick="hideSectionChartsModal()">×</span>
            <h2><i class="fas fa-chart-pie"></i> Section Charts</h2>
            <div id="sectionChartsContainer" ></div>
        </div>
    </div>
    <!-- Category Modal -->
    <div id="categoryManagementModal" class="modal">
        <div class="modal-content card">
            <span class="close" onclick="hideCategoryManagement()">×</span>
            <h2><i class="fas fa-layer-group"></i> Payment Categories</h2>
            
            <div class="categories-container" id="categoriesContainer">
                <!-- Categories will be loaded here -->
            </div>
            
            <div class="card category-form">
                <h3><i class="fas fa-plus-circle"></i> Add New Category</h3>
                <form id="categoryForm">
                    <div class="form-group">
                        <label for="categoryName"><i class="fas fa-tag"></i> Category Name:</label>
                        <input type="text" id="categoryName" required placeholder="e.g., Semester 1 Fees">
                    </div>
                    <div class="form-group">
                        <label for="categoryDescription"><i class="fas fa-align-left"></i> Description (optional):</label>
                        <textarea id="categoryDescription" placeholder="Brief description of this category"></textarea>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-bullseye"></i> Target Amount (₱):</label>
                        <input type="number" id="categoryTarget" placeholder="e.g., 5000" step="0.01" min="0">
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Category</button>
                </form>
            </div>
        </div>
    </div>


    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="main.js"></script>
</body>
</html>
